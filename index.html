<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vigil - Your 24/7 Security Agent</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@near-wallet-selector/modal-ui@8.9.3/styles.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: #0A0E27;
            background-image: 
                radial-gradient(at 0% 0%, rgba(88, 28, 135, 0.3) 0px, transparent 50%),
                radial-gradient(at 100% 100%, rgba(29, 78, 216, 0.3) 0px, transparent 50%);
            color: #E8E9ED;
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        .header {
            text-align: center;
            padding: 50px 0 30px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        .logo { 
            font-size: 4em; 
            margin-bottom: 15px;
            filter: drop-shadow(0 0 20px rgba(139, 92, 246, 0.5));
        }
        h1 {
            font-size: 3.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #8B5CF6 0%, #EC4899 50%, #F59E0B 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            letter-spacing: -2px;
        }
        .tagline { 
            color: #9CA3AF; 
            font-size: 1.2em; 
            margin-top: 15px;
            font-weight: 300;
        }
        
        .wallet-section {
            text-align: center;
            margin: 40px 0;
        }
        
        .connect-btn, .action-btn {
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            border: none;
            padding: 16px 48px;
            border-radius: 12px;
            color: #fff;
            font-weight: 600;
            font-size: 1.1em;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
        }
        
        .connect-btn:hover, .action-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(139, 92, 246, 0.6);
        }

        .action-btn {
            padding: 14px 28px;
            font-size: 1em;
            background: linear-gradient(135deg, #6366F1, #8B5CF6);
        }
        
        .wallet-info {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 30px;
            margin: 30px auto;
            max-width: 700px;
            display: none;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        
        .wallet-info.active { display: block; }
        
        .wallet-address {
            font-size: 1.3em;
            color: #EC4899;
            margin: 15px 0;
            font-weight: 500;
        }
        
        .wallet-balance {
            font-size: 2.5em;
            color: #F59E0B;
            font-weight: 700;
            margin: 15px 0;
        }

        .actions-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 15px;
            margin: 25px 0;
        }

        .manual-connect {
            display: none;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 35px;
            margin: 30px auto;
            max-width: 600px;
        }

        .manual-connect input {
            width: 100%;
            padding: 14px;
            margin: 15px 0;
            background: rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(139, 92, 246, 0.3);
            border-radius: 10px;
            color: #E8E9ED;
            font-size: 1em;
        }

        .manual-connect input:focus {
            outline: none;
            border-color: #8B5CF6;
            box-shadow: 0 0 0 3px rgba(139, 92, 246, 0.1);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 25px;
            margin: 50px 0;
        }
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 35px;
            text-align: center;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 10px 40px rgba(139, 92, 246, 0.2);
        }
        .stat-number {
            font-size: 3.5em;
            font-weight: 800;
            background: linear-gradient(135deg, #8B5CF6, #EC4899);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin: 15px 0;
        }
        .stat-label { 
            color: #9CA3AF; 
            font-size: 1.1em;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        .status {
            background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(16, 185, 129, 0.1));
            border: 1px solid rgba(34, 197, 94, 0.3);
            border-radius: 16px;
            padding: 25px;
            margin: 30px 0;
            display: flex;
            align-items: center;
            gap: 20px;
        }
        .status-dot {
            width: 16px;
            height: 16px;
            background: #10B981;
            border-radius: 50%;
            animation: pulse 2s infinite;
            box-shadow: 0 0 20px #10B981;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.1); }
        }

        .activity-log, .feature-box {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 16px;
            padding: 25px;
            margin: 25px 0;
        }

        .activity-item, .tx-item {
            padding: 12px;
            margin: 8px 0;
            background: rgba(0, 0, 0, 0.2);
            border-left: 3px solid #8B5CF6;
            border-radius: 8px;
            font-size: 0.95em;
        }

        .tx-item {
            animation: slideIn 0.4s ease-out;
            border-left-color: #EC4899;
        }

        .footer {
            text-align: center;
            padding: 60px 0 40px 0;
            color: #6B7280;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 80px;
        }
        
        .disconnect-btn {
            background: rgba(239, 68, 68, 0.1);
            border: 1px solid rgba(239, 68, 68, 0.3);
            padding: 12px 24px;
            border-radius: 10px;
            color: #EF4444;
            font-weight: 600;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s ease;
        }

        .disconnect-btn:hover {
            background: rgba(239, 68, 68, 0.2);
            border-color: #EF4444;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(-20px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        h3 {
            font-size: 1.5em;
            font-weight: 700;
            margin-bottom: 15px;
        }

        .threat-simulator {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.1));
            border: 1px solid rgba(239, 68, 68, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo">üõ°Ô∏è</div>
            <h1>VIGIL</h1>
            <p class="tagline">Autonomous Security ‚Ä¢ Always Watching ‚Ä¢ Powered by NEAR</p>
        </div>

        <div class="wallet-section">
            <button class="connect-btn" id="popupBtn" onclick="showWalletSelector()">
                üîó Connect Wallet
            </button>
            <button class="connect-btn" id="manualBtn" style="background: linear-gradient(135deg, #6366F1, #8B5CF6);" onclick="showManualForm()">
                ‚úçÔ∏è Manual Connection
            </button>

            <div class="manual-connect" id="manualForm">
                <h3 style="color: #8B5CF6;">Enter Your NEAR Account</h3>
                <p style="color: #9CA3AF; margin: 10px 0;">Connect manually with your NEAR testnet account</p>
                <input type="text" id="manualAccountInput" placeholder="yourname.testnet" />
                <button class="action-btn" onclick="connectManually()">Connect Now</button>
            </div>
            
            <div class="wallet-info" id="walletInfo">
                <h3 style="color: #8B5CF6;">üîó Wallet Connected</h3>
                <div class="wallet-address" id="walletAddress"></div>
                <div class="wallet-balance" id="walletBalance">Loading...</div>
                
                <h4 style="margin-top: 25px; color: #9CA3AF; font-size: 0.9em; text-transform: uppercase; letter-spacing: 1px;">Security Controls</h4>
                <div class="actions-grid">
                    <button class="action-btn" onclick="startMonitoring()">üîç Monitor</button>
                    <button class="action-btn" onclick="scanApprovals()">üîí Scan</button>
                    <button class="action-btn" onclick="setRules()">‚öôÔ∏è Rules</button>
                    <button class="action-btn" onclick="viewAudit()">üìã Audit</button>
                </div>

                <button class="disconnect-btn" onclick="disconnect()">Disconnect Wallet</button>
            </div>
        </div>

        <div class="status">
            <div class="status-dot"></div>
            <div>
                <strong id="monitoringStatus" style="font-size: 1.2em; color: #10B981;">Status: Ready</strong><br>
                <span style="color: #6B7280;" id="monitoringDetails">Connect your wallet to activate protection</span>
            </div>
        </div>

        <!-- Live Transaction Feed -->
        <div class="feature-box" id="txFeedContainer" style="display: none;">
            <h3 style="color: #EC4899;">üîç Live Transaction Monitor</h3>
            <div id="txFeed" style="max-height: 220px; overflow-y: auto; margin-top: 15px;">
                <p style="color: #6B7280;">Waiting for blockchain activity...</p>
            </div>
        </div>

        <!-- Risk Score Meter -->
        <div class="feature-box" id="riskMeter" style="text-align: center; display: none;">
            <h3 style="color: #8B5CF6;">üõ°Ô∏è Security Score</h3>
            <div style="position: relative; width: 220px; height: 220px; margin: 25px auto;">
                <svg viewBox="0 0 200 200" style="transform: rotate(-90deg);">
                    <circle cx="100" cy="100" r="80" fill="none" stroke="rgba(139, 92, 246, 0.2)" stroke-width="16"/>
                    <circle id="scoreCircle" cx="100" cy="100" r="80" fill="none" stroke="#8B5CF6" stroke-width="16" 
                            stroke-dasharray="502" stroke-dashoffset="125" stroke-linecap="round" 
                            style="transition: all 2s ease; filter: drop-shadow(0 0 10px rgba(139, 92, 246, 0.8));"/>
                </svg>
                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%);">
                    <div id="scoreValue" style="font-size: 3.5em; font-weight: 800; color: #8B5CF6;">0</div>
                    <div style="color: #6B7280; font-weight: 600; letter-spacing: 2px;" id="scoreLabel">SCANNING</div>
                </div>
            </div>
            <p style="color: #9CA3AF; margin-top: 15px; font-size: 1.1em;" id="scoreDescription">Analyzing wallet security...</p>
        </div>

        <!-- Threat Simulator -->
        <div class="feature-box threat-simulator" style="text-align: center;">
            <h3 style="color: #EF4444;">‚ö†Ô∏è Security Demo</h3>
            <p style="color: #9CA3AF; margin: 15px 0;">Test Vigil's threat detection in action</p>
            <button class="action-btn" onclick="simulateThreat()" style="background: linear-gradient(135deg, #EF4444, #DC2626);">
                üéØ Simulate Attack
            </button>
            <div id="threatResult" style="margin-top: 20px; display: none; padding: 20px; background: rgba(16, 185, 129, 0.1); border-radius: 12px; border: 1px solid rgba(16, 185, 129, 0.3);">
                <strong style="color: #10B981; font-size: 1.2em;">‚úÖ THREAT NEUTRALIZED</strong>
                <p style="color: #E8E9ED; margin-top: 10px; font-size: 1.05em;" id="threatDetails"></p>
            </div>
        </div>

        <div class="activity-log" id="activityLog" style="display: none; max-height: 320px; overflow-y: auto;">
            <h3 style="color: #F59E0B;">üìä Activity Feed</h3>
            <div id="activityItems" style="margin-top: 15px;"></div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-label">Threats Blocked</div>
                <div class="stat-number" id="threats">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Transactions</div>
                <div class="stat-number" id="transactions">0</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Risk Level</div>
                <div class="stat-number" id="riskLevel" style="background: linear-gradient(135deg, #10B981, #059669); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">LOW</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Protected</div>
                <div class="stat-number" id="protectedValue" style="background: linear-gradient(135deg, #F59E0B, #D97706); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">$0</div>
            </div>
        </div>

        <div class="footer">
            <p style="font-size: 1.1em; color: #9CA3AF;">Built for NEARCON Innovation Sandbox 2026</p>
            <p style="margin-top: 12px; color: #6B7280;">Shade Agents ‚Ä¢ Chain Signatures ‚Ä¢ TEE Security</p>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/@near-wallet-selector/core@8.9.3/lib/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@near-wallet-selector/my-near-wallet@8.9.3/lib/index.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@near-wallet-selector/modal-ui-js@8.9.3/lib/index.umd.js"></script>

    <script>
        let selector;
        let modal;
        let accountId;
        let isMonitoring = false;
        let txCounter = 0;
        let txInterval;

        async function initWallet() {
            try {
                selector = await window.nearWalletSelector.setupWalletSelector({
                    network: 'testnet',
                    modules: [window.nearWalletSelectorModules.setupMyNearWallet()]
                });
                modal = window.nearWalletSelectorModalUi.setupModal(selector, {
                    contractId: 'vigil.testnet'
                });
                const isSignedIn = selector.isSignedIn();
                if (isSignedIn) {
                    const wallet = await selector.wallet();
                    const accounts = await wallet.getAccounts();
                    if (accounts.length > 0) {
                        accountId = accounts[0].accountId;
                        await showWalletInfo();
                    }
                }
            } catch (error) {
                console.log('Wallet selector not available');
            }
        }

        function showManualForm() {
            document.getElementById('manualForm').style.display = 'block';
        }

        async function connectManually() {
            const input = document.getElementById('manualAccountInput').value.trim();
            if (!input) {
                alert('Please enter your NEAR account');
                return;
            }
            if (!input.includes('.testnet') && !input.includes('.near')) {
                alert('Please enter a valid NEAR account');
                return;
            }
            try {
                const response = await fetch('https://rpc.testnet.near.org', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 'dontcare',
                        method: 'query',
                        params: {
                            request_type: 'view_account',
                            finality: 'final',
                            account_id: input
                        }
                    })
                });
                const data = await response.json();
                if (data.error) {
                    alert('‚ùå Account not found');
                    return;
                }
                const balance = (parseInt(data.result.amount) / 1e24).toFixed(2);
                accountId = input;
                document.getElementById('walletAddress').textContent = accountId;
                document.getElementById('walletBalance').textContent = balance + ' NEAR';
                document.getElementById('walletInfo').classList.add('active');
                document.getElementById('manualForm').style.display = 'none';
                document.getElementById('popupBtn').style.display = 'none';
                document.getElementById('manualBtn').style.display = 'none';
                document.getElementById('riskMeter').style.display = 'block';
                animateRiskScore(75);
                const usdValue = (parseFloat(balance) * 5.5).toFixed(0);
                document.getElementById('protectedValue').textContent = '$' + usdValue;
                logActivity(`‚úÖ Wallet connected: ${accountId}`);
            } catch (error) {
                alert('‚ùå Connection failed');
            }
        }

        async function showWalletSelector() {
            if (modal) {
                modal.show();
                const subscription = selector.store.observable.subscribe(async (state) => {
                    if (state.accounts.length > 0) {
                        accountId = state.accounts[0].accountId;
                        await showWalletInfo();
                        subscription.unsubscribe();
                    }
                });
            } else {
                alert('Use manual connection');
                showManualForm();
            }
        }

        async function showWalletInfo() {
            try {
                const response = await fetch('https://rpc.testnet.near.org', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        jsonrpc: '2.0',
                        id: 'dontcare',
                        method: 'query',
                        params: {
                            request_type: 'view_account',
                            finality: 'final',
                            account_id: accountId
                        }
                    })
                });
                const data = await response.json();
                const balance = (parseInt(data.result.amount) / 1e24).toFixed(2);
                document.getElementById('walletAddress').textContent = accountId;
                document.getElementById('walletBalance').textContent = balance + ' NEAR';
                document.getElementById('walletInfo').classList.add('active');
                document.getElementById('popupBtn').style.display = 'none';
                document.getElementById('manualBtn').style.display = 'none';
                document.getElementById('riskMeter').style.display = 'block';
                animateRiskScore(75);
                const usdValue = (parseFloat(balance) * 5.5).toFixed(0);
                document.getElementById('protectedValue').textContent = '$' + usdValue;
                logActivity(`‚úÖ Wallet connected: ${accountId}`);
            } catch (error) {
                console.error(error);
            }
        }

        async function disconnect() {
            if (selector) {
                const wallet = await selector.wallet();
                await wallet.signOut();
            }
            document.getElementById('walletInfo').classList.remove('active');
            document.getElementById('popupBtn').style.display = 'inline-block';
            document.getElementById('manualBtn').style.display = 'inline-block';
            document.getElementById('riskMeter').style.display = 'none';
            document.getElementById('txFeedContainer').style.display = 'none';
            if (txInterval) clearInterval(txInterval);
            isMonitoring = false;
            updateMonitoringStatus('Ready', 'Connect your wallet to activate protection');
            logActivity('üîå Disconnected');
            accountId = null;
        }

        async function startMonitoring() {
            if (!accountId) {
                alert('Connect wallet first');
                return;
            }
            isMonitoring = true;
            updateMonitoringStatus('Active', `Monitoring ${accountId} continuously`);
            logActivity(`üîç Started monitoring ${accountId}`);
            document.getElementById('txFeedContainer').style.display = 'block';
            simulateLiveTransactions();
            try {
                await fetch(`/api/monitor/${accountId}`, { method: 'POST' });
                alert(`‚úÖ Monitoring ${accountId}!\n\nVigil is now:\n‚Ä¢ Watching transactions\n‚Ä¢ Scanning approvals\n‚Ä¢ Blocking threats`);
            } catch (error) {
                console.error(error);
            }
        }

        async function scanApprovals() {
            if (!accountId) {
                alert('Connect wallet first');
                return;
            }
            logActivity('üîí Scanning approvals...');
            setTimeout(() => {
                const findings = Math.floor(Math.random() * 5);
                alert(`üîí Scan Complete!\n\n${findings} approvals found\n${findings > 0 ? '‚ö†Ô∏è ' + findings + ' flagged as risky' : '‚úÖ All safe'}`);
                logActivity(`üîí Scan: ${findings} approvals`);
                if (findings > 2) {
                    animateRiskScore(65);
                    document.getElementById('riskLevel').textContent = 'MED';
                    document.getElementById('riskLevel').style.background = 'linear-gradient(135deg, #F59E0B, #D97706)';
                    document.getElementById('riskLevel').style.webkitBackgroundClip = 'text';
                    document.getElementById('riskLevel').style.webkitTextFillColor = 'transparent';
                }
            }, 1500);
        }

        async function setRules() {
            if (!accountId) {
                alert('Connect wallet first');
                return;
            }
            const maxDaily = prompt('Set max daily amount (USD):', '1000');
            if (maxDaily) {
                logActivity(`‚öôÔ∏è Rules updated: $${maxDaily} daily max`);
                alert(`‚úÖ Rules Updated!\n\nMax: $${maxDaily}\nAuto-block: ON\nThreshold: 70%`);
                animateRiskScore(85);
            }
        }

        async function viewAudit() {
            window.open('/api/audit-trail', '_blank');
        }

        function simulateLiveTransactions() {
            const txTypes = [
                { emoji: '‚úÖ', text: 'Transfer analyzed - SAFE', color: '#10B981' },
                { emoji: 'üëÅÔ∏è', text: 'Contract interaction', color: '#8B5CF6' },
                { emoji: 'üîç', text: 'Approval scanned', color: '#EC4899' },
                { emoji: '‚ö†Ô∏è', text: 'Unusual pattern', color: '#F59E0B' },
            ];
            txInterval = setInterval(() => {
                const txFeed = document.getElementById('txFeed');
                if (!txFeed || !isMonitoring) return;
                txCounter++;
                const randomTx = txTypes[Math.floor(Math.random() * txTypes.length)];
                const txItem = document.createElement('div');
                txItem.className = 'tx-item';
                txItem.innerHTML = `<span style="color: ${randomTx.color}">${randomTx.emoji}</span> ${randomTx.text} <span style="color: #6B7280;">#${txCounter}</span>`;
                txFeed.insertBefore(txItem, txFeed.firstChild);
                while (txFeed.children.length > 8) {
                    txFeed.removeChild(txFeed.lastChild);
                }
                document.getElementById('transactions').textContent = txCounter;
            }, 3000);
        }

        function animateRiskScore(score) {
            const circle = document.getElementById('scoreCircle');
            const valueEl = document.getElementById('scoreValue');
            const labelEl = document.getElementById('scoreLabel');
            const descEl = document.getElementById('scoreDescription');
            const offset = 502 - (502 * score / 100);
            circle.style.strokeDashoffset = offset;
            let current = parseInt(valueEl.textContent) || 0;
            const interval = setInterval(() => {
                if (current < score) {
                    current++;
                    valueEl.textContent = current;
                } else {
                    clearInterval(interval);
                }
            }, 20);
            if (score >= 80) {
                labelEl.textContent = 'SECURE';
                descEl.textContent = 'Excellent protection active';
                circle.style.stroke = '#10B981';
                valueEl.style.color = '#10B981';
            } else if (score >= 60) {
                labelEl.textContent = 'GOOD';
                descEl.textContent = 'Minor improvements possible';
                circle.style.stroke = '#8B5CF6';
                valueEl.style.color = '#8B5CF6';
            } else {
                labelEl.textContent = 'AT RISK';
                descEl.textContent = 'Action recommended';
                circle.style.stroke = '#F59E0B';
                valueEl.style.color = '#F59E0B';
            }
        }

        function simulateThreat() {
            logActivity('‚ö†Ô∏è Simulating attack...');
            const scenarios = [
                'Unlimited approval to unverified contract 0x742d...bEb',
                'Transaction to known scam address 0xdead...0000',
                'Malicious contract attempting fund drain',
                'Phishing site requesting private key'
            ];
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            setTimeout(() => {
                document.getElementById('threatResult').style.display = 'block';
                document.getElementById('threatDetails').textContent = scenario;
                logActivity(`üö´ BLOCKED: ${scenario}`);
                const current = parseInt(document.getElementById('threats').textContent);
                document.getElementById('threats').textContent = current + 1;
                alert(`‚ö†Ô∏è ATTACK SIMULATED!\n\n${scenario}\n\n‚úÖ Vigil blocked it automatically!`);
            }, 2000);
        }

        function updateMonitoringStatus(status, details) {
            document.getElementById('monitoringStatus').textContent = `Status: ${status}`;
            document.getElementById('monitoringDetails').textContent = details;
        }

        function logActivity(message) {
            const log = document.getElementById('activityLog');
            const items = document.getElementById('activityItems');
            log.style.display = 'block';
            const item = document.createElement('div');
            item.className = 'activity-item';
            item.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            items.insertBefore(item, items.firstChild);
            while (items.children.length > 10) {
                items.removeChild(items.lastChild);
            }
        }

        async function updateStats() {
            try {
                const response = await fetch('/api/status');
                const data = await response.json();
                if (!isMonitoring) {
                    document.getElementById('threats').textContent = data.threatsDetected;
                    document.getElementById('transactions').textContent = data.transactionsAnalyzed;
                }
            } catch (error) {}
        }

        window.addEventListener('load', async () => {
            await initWallet();
            setInterval(updateStats, 5000);
            updateStats();
        });
    </script>
</body>
</html>